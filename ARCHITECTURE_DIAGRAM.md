# ğŸ—ï¸ Workspace Integration Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         IDEA_HUB System                             â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   React SPA (Port 3000)â”‚        â”‚  Next.js App (Port 3001)â”‚     â”‚
â”‚  â”‚     IDEA_HUB Main      â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚   idea_workspace        â”‚     â”‚
â”‚  â”‚                         â”‚ iframe  â”‚                         â”‚     â”‚
â”‚  â”‚  - Browse Ideas         â”‚postMsg â”‚  - Editor.js (Document) â”‚     â”‚
â”‚  â”‚  - User Management      â”‚        â”‚  - Excalidraw (Canvas)  â”‚     â”‚
â”‚  â”‚  - Social Features      â”‚        â”‚  - Auto-save            â”‚     â”‚
â”‚  â”‚  - Permissions          â”‚        â”‚                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                                    â”‚                    â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                        â”‚                                            â”‚
â”‚                        â–¼                                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚           â”‚  Netlify Functions     â”‚                                â”‚
â”‚           â”‚  (Serverless APIs)     â”‚                                â”‚
â”‚           â”‚                        â”‚                                â”‚
â”‚           â”‚  - ideas-*             â”‚                                â”‚
â”‚           â”‚  - workspaces-*        â”‚                                â”‚
â”‚           â”‚  - auth-*              â”‚                                â”‚
â”‚           â”‚  - workspace-permissionsâ”‚                               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                        â”‚                                            â”‚
â”‚                        â–¼                                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚           â”‚   PostgreSQL Database  â”‚                                â”‚
â”‚           â”‚   (via Prisma ORM)     â”‚                                â”‚
â”‚           â”‚                        â”‚                                â”‚
â”‚           â”‚  Tables:               â”‚                                â”‚
â”‚           â”‚  - ideas               â”‚                                â”‚
â”‚           â”‚  - workspaces          â”‚                                â”‚
â”‚           â”‚  - users               â”‚                                â”‚
â”‚           â”‚  - idea_collaborators  â”‚                                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Creating an Idea

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â”‚ Clicks  â”‚
â”‚ "Create"â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IdeaWorkspacePage    â”‚
â”‚  (React Component)     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ API Call: POST /ideas-create
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ideas-create.ts        â”‚
â”‚ (Netlify Function)     â”‚
â”‚                        â”‚
â”‚ $transaction {         â”‚
â”‚   1. Create Idea       â”‚
â”‚   2. Create Workspace  â”‚
â”‚ }                      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Success
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Navigate to:          â”‚
â”‚  /:username/idea/      â”‚
â”‚   workspace/:ideaId    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WorkspaceViewPage     â”‚
â”‚  (React Component)     â”‚
â”‚                        â”‚
â”‚  1. Fetch permissions  â”‚
â”‚  2. Render iframe      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WorkspaceIframe       â”‚
â”‚  (React Component)     â”‚
â”‚                        â”‚
â”‚  URL: localhost:3001/  â”‚
â”‚    workspace/{id}?     â”‚
â”‚    mode=edit&          â”‚
â”‚    token=JWT           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Next.js Workspace     â”‚
â”‚  (idea_workspace)      â”‚
â”‚                        â”‚
â”‚  - Load workspace data â”‚
â”‚  - Render Editor       â”‚
â”‚  - Render Canvas       â”‚
â”‚  - Send WORKSPACE_     â”‚
â”‚    LOADED event        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Editing Workspace

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â”‚ Edits   â”‚
â”‚ Content â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Editor or Canvas      â”‚
â”‚  (idea_workspace)      â”‚
â”‚                        â”‚
â”‚  Auto-save triggers    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ API Call: PATCH /api/workspace/{id}
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Next.js API Route      â”‚
â”‚ /api/workspace/[id]    â”‚
â”‚                        â”‚
â”‚ Update:                â”‚
â”‚  - document (EditorJS) â”‚
â”‚  - whiteboard (Canvas) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Update Database
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL            â”‚
â”‚  workspaces table      â”‚
â”‚                        â”‚
â”‚  {                     â”‚
â”‚    document: {...}     â”‚
â”‚    whiteboard: {...}   â”‚
â”‚  }                     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Success
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ postMessage Event      â”‚
â”‚                        â”‚
â”‚ {                      â”‚
â”‚   type: 'SAVE_SUCCESS',â”‚
â”‚   source: 'workspace'  â”‚
â”‚ }                      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WorkspaceIframe       â”‚
â”‚  (Parent Window)       â”‚
â”‚                        â”‚
â”‚  Receives event,       â”‚
â”‚  shows notification    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Forking an Idea

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚
â”‚ Views   â”‚
â”‚ Public  â”‚
â”‚  Idea   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WorkspaceViewPage     â”‚
â”‚                        â”‚
â”‚  Permission Check:     â”‚
â”‚  - canView: true       â”‚
â”‚  - canEdit: false      â”‚
â”‚  - canFork: true       â”‚
â”‚                        â”‚
â”‚  Show: "Fork to Edit"  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ User clicks Fork
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  handleFork()          â”‚
â”‚                        â”‚
â”‚  API Call:             â”‚
â”‚  POST /ideas-fork      â”‚
â”‚  { ideaId: "..." }     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ideas-fork.ts          â”‚
â”‚ (Netlify Function)     â”‚
â”‚                        â”‚
â”‚ $transaction {         â”‚
â”‚   1. Get original      â”‚
â”‚      workspace         â”‚
â”‚   2. Create forked ideaâ”‚
â”‚   3. Copy workspace    â”‚
â”‚      - document        â”‚
â”‚      - whiteboard      â”‚
â”‚   4. Increment fork    â”‚
â”‚      count             â”‚
â”‚   5. Notify author     â”‚
â”‚ }                      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Success
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Navigate to:          â”‚
â”‚  /:username/idea/      â”‚
â”‚   workspace/:newId     â”‚
â”‚                        â”‚
â”‚  User now owns copy    â”‚
â”‚  and can edit          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Permission Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Permission Matrix                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   User Role  â”‚ Can View â”‚ Can Edit â”‚ Can Fork â”‚ Can      â”‚
â”‚              â”‚          â”‚          â”‚          â”‚ Manage   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Owner        â”‚    âœ…    â”‚    âœ…    â”‚    âŒ    â”‚    âœ…    â”‚
â”‚              â”‚          â”‚          â”‚   (own)  â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Collaborator â”‚    âœ…    â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ (EDITOR)     â”‚          â”‚          â”‚          â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Collaborator â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ (VIEWER)     â”‚          â”‚          â”‚          â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Other User   â”‚    âœ…    â”‚    âŒ    â”‚    âœ…    â”‚    âŒ    â”‚
â”‚ (Public Idea)â”‚          â”‚          â”‚          â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Other User   â”‚    âŒ    â”‚    âŒ    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚(Private Idea)â”‚          â”‚          â”‚          â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Anonymous    â”‚    âœ…    â”‚    âŒ    â”‚    âŒ    â”‚    âŒ    â”‚
â”‚ (Public Idea)â”‚          â”‚          â”‚          â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Notes:
- "Can Manage" = Change visibility, add/remove collaborators
- Forking creates a new copy under the forking user's ownership
- Max 3 collaborators per idea
```

## Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)         â”‚
â”‚ username        â”‚
â”‚ email           â”‚
â”‚ ...             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 1:N
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       1:1        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ideas       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   workspaces    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)         â”‚                   â”‚ id (PK)         â”‚
â”‚ title           â”‚                   â”‚ ideaId (FK,UNQ) â”‚
â”‚ description     â”‚                   â”‚ userId (FK)     â”‚
â”‚ authorId (FK)   â”‚                   â”‚ document        â”‚
â”‚ visibility      â”‚                   â”‚ whiteboard      â”‚
â”‚ isFork          â”‚                   â”‚ archived        â”‚
â”‚ forkedFrom (FK) â”‚                   â”‚ ...             â”‚
â”‚ ...             â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ 1:N
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  idea_collaborators     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ id (PK)                 â”‚
â”‚ ideaId (FK)             â”‚
â”‚ userId (FK)             â”‚
â”‚ role (OWNER/EDITOR/     â”‚
â”‚       VIEWER)           â”‚
â”‚ ...                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Constraints:
- One workspace per idea (UNIQUE ideaId in workspaces)
- Max 3 collaborators per idea (enforced in API)
- Cascade delete: Delete idea â†’ Delete workspace
```

## postMessage Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              iframe â†” Parent Communication               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  From Workspace (iframe) â†’ Parent:                      â”‚
â”‚                                                          â”‚
â”‚  {                                                       â”‚
â”‚    type: 'WORKSPACE_LOADED',                             â”‚
â”‚    source: 'workspace'                                   â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â”‚  {                                                       â”‚
â”‚    type: 'SAVE_SUCCESS',                                 â”‚
â”‚    payload: { timestamp, workspaceId },                  â”‚
â”‚    source: 'workspace'                                   â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â”‚  {                                                       â”‚
â”‚    type: 'FORK_REQUEST',                                 â”‚
â”‚    payload: { ideaId },                                  â”‚
â”‚    source: 'workspace'                                   â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â”‚  {                                                       â”‚
â”‚    type: 'ERROR',                                        â”‚
â”‚    payload: { message },                                 â”‚
â”‚    source: 'workspace'                                   â”‚
â”‚  }                                                       â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Structure

```
IDEA_HUB/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ Workspace/
â”‚   â”‚       â””â”€â”€ WorkspaceIframe.tsx       â† iframe wrapper
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ WorkspaceViewPage.tsx         â† main workspace page
â”‚   â”‚   â””â”€â”€ IdeaWorkspacePage.tsx         â† redirects to workspace
â”‚   â””â”€â”€ App.tsx                           â† routing
â”‚
â”œâ”€â”€ netlify/functions/
â”‚   â”œâ”€â”€ ideas-create.ts                   â† atomic creation
â”‚   â”œâ”€â”€ ideas-fork.ts                     â† fork with workspace
â”‚   â”œâ”€â”€ workspaces-update.ts              â† update document/whiteboard
â”‚   â””â”€â”€ workspace-permissions.ts          â† NEW permission checker
â”‚
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma                     â† database schema
â”‚
â”œâ”€â”€ idea_workspace/ideahubORM/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ (routes)/workspace/[fileId]/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx                  â† iframe content
â”‚   â”‚   â””â”€â”€ api/workspace/[id]/
â”‚   â”‚       â””â”€â”€ route.ts                  â† workspace API
â”‚   â””â”€â”€ prisma/
â”‚       â””â”€â”€ schema.prisma                 â† workspace schema
â”‚
â””â”€â”€ Documentation/
    â”œâ”€â”€ SETUP_GUIDE.md                    â† setup instructions
    â”œâ”€â”€ INTEGRATION_COMPLETION_SUMMARY.md â† implementation details
    â””â”€â”€ MIGRATION_AGENT_NOTES.md          â† architecture overview
```

---

**Legend:**
- `â†’` HTTP Request
- `â†â†’` Bidirectional Communication
- `â–¼` Data Flow
- `âœ…` Allowed
- `âŒ` Not Allowed
- `PK` Primary Key
- `FK` Foreign Key
- `UNQ` Unique Constraint
